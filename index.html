<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON Editor</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="loading-indicator" id="loadingIndicator">
        <span>Loading...</span>
    </div>

    <div class="top-container">
        <h1 id="Name">Loading...</h1>
        <img id="Image" src="#" alt="User Image">
    </div>

    <div class="container" id="dynamicContainers"></div>

    <script>
        function toggleExpand(header) {
            const content = header.nextElementSibling;
            if (content.style.maxHeight) {
                content.style.maxHeight = null;
            } else {
                content.style.maxHeight = content.scrollHeight + "px";
            }
        }

        function saveField(fieldId) {
            const fieldValue = document.getElementById(fieldId).value;
            console.log(`Saved ${fieldId}: ${fieldValue}`);
        }

        function addToFieldFromDropdown(dropdown, fieldId) {
            const fieldValue = document.getElementById(fieldId).value;
            const selectedValue = dropdown.value;
            document.getElementById(fieldId).value = fieldValue ? `${fieldValue}, ${selectedValue}` : selectedValue;
        }

        function createExpandableContainerHTML(key, value, iconUrl) {
            let contentHTML = '';

            if (key === 'liveLocation') {
                contentHTML = `<iframe src='https://earth.google.com/web/' style='width: 100%; height: 200px;'></iframe>`;
            } else if (Array.isArray(value)) {
                const optionsHTML = value.map(item => `<option value='${item}'>${item}</option>`).join('');
                contentHTML = `
                    <select onchange="addToFieldFromDropdown(this, '${key}')">${optionsHTML}</select>
                    <input type="text" id="${key}" ondblclick="handleDoubleClick(event)">
                `;
            } else if (key === 'website') {
                contentHTML = `<iframe src='${value}' style='width: 100%; height: 200px;'></iframe>`;
            } else {
                contentHTML = `<input type="text" id="${key}" value="${value}" ondblclick="handleDoubleClick(event)">`;
            }

            return `
                <div class="expandable-container">
                    <h2 onclick="toggleExpand(this)">
                        <img src="${iconUrl}" alt="Icon for ${key}">
                        ${key}
                    </h2>
                    <div class="expandable-content">
                        ${contentHTML}
                        <button onclick="saveField('${key}')">Save Changes</button>
                    </div>
                </div>
            `;
        }

        function handleDoubleClick(event) {
            const clickedValue = event.target.value;
            document.getElementById('loadingIndicator').classList.add('active');
            fetch(`https://honorsystem.github.io/honorsystem/${clickedValue}.json`)
                .then(response => response.json())
                .then(data => {
                    populateData(data);
                    document.getElementById('loadingIndicator').classList.remove('active');
                })
                .catch(error => {
                    console.error('Error fetching the JSON data:', error);
                    document.getElementById('loadingIndicator').classList.remove('active');
                    alert('Failed to fetch data. Please try again.');
                });
        }

        function populateData(data) {
            const dynamicContainers = document.getElementById('dynamicContainers');
            dynamicContainers.innerHTML = '';
            for (let key in data) {
                if (key !== "id" && key !== "name" && key !== "icon" && key !== "image" && key !== "backgroundImage") {
                    dynamicContainers.innerHTML += createExpandableContainerHTML(key, data[key], data.icon);
                }
            }
            document.getElementById('Name').innerText = `${data.firstName} ${data.lastName}`;
            document.getElementById('Image').src = data.image;
            document.querySelector('.top-container').style.backgroundImage = `url(${data.backgroundImage})`;
        }

        function initializePage() {
            const data = {
                // ... [Your data object here]
            };
            populateData(data);
        }

        window.onload = initializePage;
    </script>
</body>

</html>
