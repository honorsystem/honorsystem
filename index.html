<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON editor</title>
    <style>
        /* Your CSS styles here */
    </style>
</head>

<body>
    <div class="top-container">
        <h1 id="Name">John Doe</h1>
        <img id="Image" src="https://i.imgur.com/H1jOpkr.png" alt="Image">
    </div>

    <div class="container" id="dynamicContainers">
        <!-- The expandable containers will be dynamically generated here -->
    </div>

    <script>
        let currentData = null;

        function toggleExpand(element) {
            const content = element.nextElementSibling;
            if (content.style.display === "none" || content.style.display === "") {
                content.style.display = "block";
            } else {
                content.style.display = "none";
                element.parentElement.style.maxHeight = "auto";
            }
        }

        function saveField(fieldId) {
            const fieldValue = document.getElementById(fieldId).value;

            if (currentData) {
                currentData.value = fieldValue;
                updateDataOnGitHub(currentData.key, fieldValue);
            }

            console.log(`Saved ${fieldId}: ${fieldValue}`);
        }

        function createExpandableContainer(key, value) {
            const container = document.createElement('div');
            container.className = 'expandable-container';

            const header = document.createElement('h2');
            header.appendChild(document.createTextNode(key));
            header.onclick = () => {
                toggleExpand(header);
                currentData = { key, value };
            };

            const content = document.createElement('div');
            content.className = 'expandable-content';

            const input = document.createElement('input');
            input.type = 'text';
            input.id = key;
            input.value = value;
            content.appendChild(input);

            const saveButton = document.createElement('button');
            saveButton.innerText = 'Save Changes';
            saveButton.onclick = () => saveField(key);
            content.appendChild(saveButton);

            container.appendChild(header);
            container.appendChild(content);

            return container;
        }

        function fetchGitHubData() {
            const accessToken = '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'; // Replace with your actual access token
            const apiUrl = 'https://raw.githubusercontent.com/honorsystem/honorsystem/main/data.json';

            fetch(apiUrl, {
                method: 'GET',
                headers: {
                    'Authorization': `token ${accessToken}`,
                },
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('dynamicContainers').innerHTML = '';
                for (let key in data) {
                    const container = createExpandableContainer(key, data[key]);
                    dynamicContainers.appendChild(container);
                }
                document.getElementById('Name').innerText = `${data.firstName} ${data.lastName}`;
                document.getElementById('Image').src = data.image;
            })
            .catch(error =>
                console.error('Error fetching the JSON data:', error)
            );
        }

        function updateDataOnGitHub(fileName, newValue) {
            const accessToken = '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'; // Replace with your actual access token
            const apiUrl = `https://api.github.com/repos/honorsystem/honorsystem/contents/data.json`;

            fetch(apiUrl, {
                method: 'GET',
                headers: {
                    'Authorization': `token ${accessToken}`,
                    'Accept': 'application/vnd.github.v3+json',
                },
            })
            .then(response => response.json())
            .then(data => {
                data.content = btoa(JSON.stringify({ ...JSON.parse(atob(data.content)), [fileName]: newValue }));

                const updateRequest = {
                    message: `Update ${fileName} field in data.json`,
                    content: data.content,
                    sha: data.sha,
                };

                fetch(apiUrl, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${accessToken}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(updateRequest),
                })
                .then(response => {
                    if (response.status === 200) {
                        console.log(`Successfully updated ${fileName} field on GitHub.`);
                    } else {
                        console.error('Error updating the field on GitHub:', response.statusText);
                    }
                })
                .catch(error => {
                    console.error('Error updating the field on GitHub:', error);
                });
            })
            .catch(error =>
                console.error('Error fetching data.json from GitHub:', error)
            );
        }

        fetchGitHubData();
    </script>
</body>

</html>
